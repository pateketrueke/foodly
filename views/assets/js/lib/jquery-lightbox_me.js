/*
* $ lightbox_me
* By: Buck Wilson
* Version : 2.3
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

(function(a){a.fn.lightbox_me=function(b){return this.each(function(){function m(){var b=e[0].style;e.css({left:"50%",marginLeft:e.outerWidth()/2*-1,zIndex:c.zIndex+3});if(e.height()+80>=a(window).height()&&(e.css("position")!="absolute"||g)){var d=a(document).scrollTop()+40;e.css({position:"absolute",top:d+"px",marginTop:0});if(g){b.removeExpression("top")}}else if(e.height()+80<a(window).height()){if(g){b.position="absolute";if(c.centered){b.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');b.marginTop=0}else{var f=c.modalCSS&&c.modalCSS.top?parseInt(c.modalCSS.top):0;b.setExpression("top","((blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+f+') + "px"')}}else{if(c.centered){e.css({position:"fixed",top:"50%",marginTop:e.outerHeight()/2*-1})}else{e.css({position:"fixed"}).css(c.modalCSS)}}}}function l(){if(a(window).height()<a(document).height()){d.css({height:a(document).height()+"px"});f.css({height:a(document).height()+"px"})}else{d.css({height:"100%"});if(g){a("html,body").css("height","100%");f.css("height","100%")}}}function k(a){if((a.keyCode==27||a.DOM_VK_ESCAPE==27&&a.which==0)&&c.closeEsc)j()}function j(){var b=e[0].style;if(c.destroyOnClose){e.add(d).remove()}else{e.add(d).hide()}if(c.parentLightbox){c.parentLightbox.fadeIn(200)}f.remove();e.undelegate(c.closeSelector,"click");a(window).unbind("reposition",l);a(window).unbind("reposition",m);a(window).unbind("scroll",m);a(document).unbind("keyup",k);if(g)b.removeExpression("top");c.onClose()}var c=a.extend({},a.fn.lightbox_me.defaults,b),d=a(),e=a(this),f=a('<iframe id="foo" style="z-index: '+(c.zIndex+1)+';border: none; margin: 0; padding: 0; position: absolute; width: 100%; height: 100%; top: 0; left: 0; filter: mask();"/>'),g=a.browser.msie&&a.browser.version<7;if(c.showOverlay){var h=a(".js_lb_overlay:visible");if(h.length>0){d=a('<div class="lb_overlay_clear js_lb_overlay"/>')}else{d=a('<div class="'+c.classPrefix+'_overlay js_lb_overlay"/>')}}if(g){var i=/^https/i.test(window.location.href||"")?"javascript:false":"about:blank";f.attr("src",i);a("body").append(f)}a("body").append(e.hide()).append(d);if(c.showOverlay){l();d.css({position:"absolute",width:"100%",top:0,left:0,right:0,bottom:0,zIndex:c.zIndex+2,display:"none"});if(!d.hasClass("lb_overlay_clear")){d.css(c.overlayCSS)}}if(c.showOverlay){d.fadeIn(c.overlaySpeed,function(){m();e[c.appearEffect](c.lightboxSpeed,function(){l();m();c.onLoad()})})}else{m();e[c.appearEffect](c.lightboxSpeed,function(){c.onLoad()})}if(c.parentLightbox){c.parentLightbox.fadeOut(200)}a(window).resize(l).resize(m).scroll(m).keyup(k);if(c.closeClick){d.click(function(a){j();a.preventDefault})}e.delegate(c.closeSelector,"click",function(a){j();a.preventDefault()});e.bind("close",j);e.bind("reposition",m)})};a.fn.lightbox_me.defaults={appearEffect:"fadeIn",appearEase:"",overlaySpeed:250,lightboxSpeed:300,closeSelector:".close",closeClick:true,closeEsc:true,destroyOnClose:false,showOverlay:true,parentLightbox:false,onLoad:function(){},onClose:function(){},classPrefix:"lb",zIndex:999,centered:false,modalCSS:{top:"40px"},overlayCSS:{background:"black",opacity:.3}}})(jQuery)
